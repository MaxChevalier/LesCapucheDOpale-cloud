<form (ngSubmit)="onSubmit()" [formGroup]="consumableForm" novalidate>
  <label for="name">Nom du consomable:</label>
  <input id="name" formControlName="name" />
  @if (name.invalid && (name.dirty || name.touched)) {
  @if (name.errors?.['required']) {
  <div class="error"><small>Le nom est requis.</small></div>
  }
  @if (name.errors?.['minlength']) {
  <div class="error"><small>Le nom doit contenir au moins 3 caractères.</small></div>
  }
  }

  <label for="type">Type d'consomable:</label>
  <select id="type" formControlName="consumableTypeId">
    <option value="" disabled>Choisissez un type</option>
    @for (type of consumableTypes; track type.id) {
    <option [value]="type.id">{{ type.name }}</option>
    }
  </select>
  <button type="button" class="add-type-btn" (click)="showTypePopup = true">
    Ajouter un type d'consomable
  </button>

  @if (showTypePopup) {
  <div class="popup-backdrop">
    <div class="popup">
      <h3>Nouveau type d'consomable</h3>

      <input type="text" formControlName="newTypeName" placeholder="Nom du type" />

      <div class="popup-actions">
        <button type="button" (click)="addNewConsumableType()">Ajouter</button>
        <button type="button" (click)="cancelPopup()">Annuler</button>
      </div>

      @if(newTypeError) {
      <p class="error">{{ newTypeError }}</p>
      }
    </div>
  </div>
  }
  @if (consumableTypeId.invalid && (consumableTypeId.dirty || consumableTypeId.touched)) {
  @if (consumableTypeId.errors?.['required']) {
  <div class="error"><small>Le type d'consomable est requis.</small></div>
  }
  }

  <app-form-money label="Coût du consomable : " [money]="getMoney()" (moneyChange)="setMoney($event)"></app-form-money>
  @if (cost.invalid && (cost.dirty || cost.touched)) {
  @if (cost.errors?.['required']) {
  <div class="error"><small>Le coût est requis.</small></div>
  }
  @if (cost.errors?.['min']) {
  <div class="error"><small>Le coût doit être supérieur ou égal à 0.</small></div>
  }
  }

  @if (!initialData){
    <label for="quantity">Quantité :</label>
    <input id="quantity" type="number" formControlName="quantity" />
    @if (quantity.invalid && (quantity.dirty || quantity.touched)) {
      @if (quantity.errors?.['required']) {
      <div class="error"><small>La quantité est requise.</small></div>
      }
      @if (quantity.errors?.['min']) {
      <div class="error"><small>La quantité doit être au moins 1.</small></div>
      }
    }
  }
  <button type="submit" [disabled]="consumableForm.invalid">Submit</button>
</form>